export const app = { "button.lgs": function(args) { this._children = []; return `<!-- ${this._path} -->${this.def("num", 0),this.def("count", () => { this.set("num", this.num + 1) })}<button onclick="${ this.count }">${ this.num }</button><!-- /${this._path} -->` }, "head.lgs": function(args) { this._children = []; return `<!-- ${this._path} --><head><title>${ args.title }</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script src="app.js" type="module"></script></head><!-- /${this._path} -->` }, "index.lgs": function(args) { this._children = []; return `<!-- ${this._path} --><!DOCTYPE html><html>${ this.use("head.lgs")({ title: "Index" }) }<body>${ this.use("button.lgs") }${ this.use("users.lgs") }</body></html><!-- /${this._path} -->` }, "user.lgs": function(args) { this._children = []; return `<!-- ${this._path} --><li id="${ this._id }"><p>${ args.name }</p><p>${ args.email }</p></li><!-- /${this._path} -->` }, "users.lgs": function(args) { this._children = []; return `<!-- ${this._path} -->${ this.def("user", this.use("user.lgs")) }${ this.def("users", []) }${this.onload(() => {fetch("https://jsonplaceholder.typicode.com/users").then(e => e.json()).then(e => this.set("users", e)).catch(e => console.log(e))})}<ul>${ this.users.map(e => this.user(e)).join("") }</ul><!-- /${this._path} -->` } }; export class LgsAppElement {constructor(parent, lgsElement) {this._parent = parent;this._children = [];this._id = this._parent ? this._parent._children.length : 0;this._path = this.getPath().join(".");this._lgs = lgsElement;}getPath() {if (!this._parent) return [];const arr = this._parent.getPath();arr.push(this._id);return arr;}use(pathToLgs) {const lgs = app[pathToLgs];if (!lgs) throw new Error("No lgs element found for path: " + pathToLgs);const lgsElement = new LgsAppElement(this, lgs);this._children.push(lgsElement);const boundLgs = lgs.bind(lgsElement);boundLgs.toString = boundLgs;return boundLgs;}onload(callback) {if (typeof this_onload == "function") return "";this._onload = callback;return "";}def(name, value) {if (typeof this[name] != "undefined") return "";const protectedProperties = ["_parent", "_children", "_id", "getPath", "use", "onload", "def"];if (protectedProperties.includes(name)) {console.error("Cannot define protected property: " + name);return "";}if (typeof value === "function") {value = value.bind(this);value.toString = () => `window.getInstance('${this._path}', window.appTree).${name}()`;}this[name] = value;return "";}set (name, value) {if (typeof this[name] == "undefined") return "";this[name] = value;this.render();return "";}render() {if (typeof document == "undefined") return "";document.body.innerHTML = document.body.innerHTML.replace(RegExp(`<!-- ${this._path} -->.*<!-- /${this._path} -->`, "m"), this._lgs.call(this));}}export function getInstance(pathToInstance, appTree) {pathToInstance = pathToInstance.split(".");for (let i = 0; i < pathToInstance.length; i++) {appTree = appTree._children[pathToInstance[i]];if (!appTree) return null;}return appTree;}if (typeof document != "undefined") {document.addEventListener("DOMContentLoaded", function() {let pageRoute = window.location.pathname.split(".")[0];if (pageRoute == "/") pageRoute = "index.lgs";pageRoute = pageRoute.replace(/^\/+|\/+$/g, "").split(".")[0]+".lgs";window.appTree = new LgsAppElement();window.appTree.use(pageRoute)();window.getInstance = getInstance;onLoadTrigger(window.appTree);});function onLoadTrigger(appTree) {if (typeof appTree._onload == "function") appTree._onload();for (let i = 0; i < appTree._children.length; i++) {onLoadTrigger(appTree._children[i]);}}}